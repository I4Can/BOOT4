{% extends "backend.html "%}


{% block html %}
<table class="table table-hover table-light">
    <tr>
        <th>ID</th>
        <th>用户</th>
        <th>内容</th>
        <th>赞</th>
        <th>时间</th>
        <th>操作</th>
    </tr>
    {% for item in message_list %}
        <tr>
            <td class="article_id">{{item.id}}</td>
            <td>{{item.user.username}}</td>
            <td style="max-width:400px;"><p>{{item.content}}</p></td>
            <td>{{item.like}}</td>
            <td>{{item.create_time|date:"Y-m-d H:i:s"}}</td>
            <td><i class="fas fa-eraser btn btn-light btn-sm btn-del" data-toggle="modal" data-target="#delMsgModal"></i></td>
        </tr>
    {%endfor%}

</table>
<div class="modal fade" id="delMsgModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body text-center">
        确认删除？
        <input type="text" id="msg_id" class="d-none">
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">取消</button>
        <button type="button" class="btn btn-primary delMsg">确认</button>
      </div>
    </div>
  </div>
</div>
{% endblock %}
{%block js%}
<script>
$(function(){
    delMsg();
})

function delMsg(){

        $('.btn-del').click(function(){
            $('#msg_id').val($(this).parent().prevAll('.article_id').text());
        })
        $('.delMsg').click(function(){
            $.ajax({
                    url:'/backend/delArticle/',
                    type:'POST',
                    headers: {"X-CSRFToken":$.cookie("csrftoken")},
                    data:{'id':$('#msg_id').val(),'type':'Message'},
                    dataType:'json',
                    success:function(arg){
                        if(arg.status){
                            location.reload();
                        }
                        else{
                            alert(arg.msg);
                        }
                    }
            })
        })
    }
</script>
{% endblock %}